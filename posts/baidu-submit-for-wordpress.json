{"id":"baidu-submit-for-wordpress","title":"WordPress 百度主动提交工具","date":"2016-02-29T09:41:20.000Z","categories":["CMS"],"tags":["PHP","SEO","Wordpress"],"html":"<p>作为目前的国内搜索主流，百度的收录规则与国外搜索引擎如谷歌、必应等不太一样，虽然它也有提供普通的Sitemap模式，但是据它自己所言通过这种方式收录效率是最低的。另外还有一种是自动推送，即在网站所有页面都加入一个JS脚本，有人访问时就会自动向百度推送该链接，但实测经常会被浏览器的AD Block插件阻拦。因此还剩下效率最高的一种方式：主动推送。我试过了一些现成的插件，好像都不太好用。因为是一个简单的功能，所以就自己写了一个小工具来实现。</p>\n<!--more-->\n<h2 id=\"\">主动推送规则 <a class=\"header-anchor\" href=\"#\" aria-hidden=\"true\">&#128279;</a></h2>\n<p>通过调用百度的一个接口，并给它传送要提交的链接，即完成了主动推送的过程，根据接口返回的信息可以判断提交的结果如何（成功/部分成功/失败）。</p>\n<p>核心代码如下（由百度提供）：</p>\n<pre><code>$urls = array(\n    'http://www.example.com/1.html',\n    'http://www.example.com/2.html',\n);\n$api = 'http://data.zz.baidu.com/urls?site=xxx&amp;token=xxx';\n$ch = curl_init();\n$options =  array(\n    CURLOPT_URL =&gt; $api,\n    CURLOPT_POST =&gt; true,\n    CURLOPT_RETURNTRANSFER =&gt; true,\n    CURLOPT_POSTFIELDS =&gt; implode(&quot;\\n&quot;, $urls),\n    CURLOPT_HTTPHEADER =&gt; array('Content-Type: text/plain'),\n);\ncurl_setopt_array($ch, $options);\n$result = curl_exec($ch);\necho $result;\n</code></pre>\n<p><code>$urls</code> 就是我们需要推送的 url 数组了，除此之外还有两个需要修改的地方，都在第5行。一是自己站点的域名，二是准入密钥。密钥会由百度站长工具提供。域名则有一点需要注意，必须填写在百度站长平台注册的域名，比如注册的时候是带有 www 的，则这里也必须带 www，否则会返回域名不一致的错误。</p>\n<p>API返回的 <code>$result</code> 是一个 JSON 对象，若推送成功可能包含以下字段：</p>\n<div class=\"table-responsive\">\n  <table class=\"table table-hover\">\n    <tr>\n      <th>\n        字段\n      </th>\n<pre><code>  &lt;th&gt;\n    是否必选\n  &lt;/th&gt;\n  \n  &lt;th&gt;\n    参数类型\n  &lt;/th&gt;\n  \n  &lt;th&gt;\n    说明\n  &lt;/th&gt;\n&lt;/tr&gt;\n\n&lt;tr&gt;\n  &lt;td&gt;\n    success\n  &lt;/td&gt;\n  \n  &lt;td&gt;\n    是\n  &lt;/td&gt;\n  \n  &lt;td&gt;\n    int\n  &lt;/td&gt;\n  \n  &lt;td&gt;\n    成功推送的url条数\n  &lt;/td&gt;\n&lt;/tr&gt;\n\n&lt;tr&gt;\n  &lt;td&gt;\n    remain\n  &lt;/td&gt;\n  \n  &lt;td&gt;\n    是\n  &lt;/td&gt;\n  \n  &lt;td&gt;\n    int\n  &lt;/td&gt;\n  \n  &lt;td&gt;\n    当天剩余的可推送url条数\n  &lt;/td&gt;\n&lt;/tr&gt;\n\n&lt;tr&gt;\n  &lt;td&gt;\n    not_same_site\n  &lt;/td&gt;\n  \n  &lt;td&gt;\n    否\n  &lt;/td&gt;\n  \n  &lt;td&gt;\n    array\n  &lt;/td&gt;\n  \n  &lt;td&gt;\n    由于不是本站url而未处理的url列表\n  &lt;/td&gt;\n&lt;/tr&gt;\n\n&lt;tr&gt;\n  &lt;td&gt;\n    not_valid\n  &lt;/td&gt;\n  \n  &lt;td&gt;\n    否\n  &lt;/td&gt;\n  \n  &lt;td&gt;\n    array\n  &lt;/td&gt;\n  \n  &lt;td&gt;\n    不合法的url列表\n  &lt;/td&gt;\n&lt;/tr&gt;\n</code></pre>\n  </table>\n</div>\n<p>示例：</p>\n<pre><code>{\n    &quot;remain&quot;:4999998,\n    &quot;success&quot;:2,\n    &quot;not_same_site&quot;:[],\n    &quot;not_valid&quot;:[]\n}\n</code></pre>\n<p>推送失败可能返回的字段：</p>\n<div class=\"table-responsive\">\n  <table class=\"table table-hover\">\n    <tr>\n      <th>\n        字段\n      </th>\n<pre><code>  &lt;th&gt;\n    是否必选\n  &lt;/th&gt;\n  \n  &lt;th&gt;\n    参数类型\n  &lt;/th&gt;\n  \n  &lt;th&gt;\n    说明\n  &lt;/th&gt;\n&lt;/tr&gt;\n\n&lt;tr&gt;\n  &lt;td&gt;\n    error\n  &lt;/td&gt;\n  \n  &lt;td&gt;\n    是\n  &lt;/td&gt;\n  \n  &lt;td&gt;\n    int\n  &lt;/td&gt;\n  \n  &lt;td&gt;\n    错误码，与状态码相同\n  &lt;/td&gt;\n&lt;/tr&gt;\n\n&lt;tr&gt;\n  &lt;td&gt;\n    message\n  &lt;/td&gt;\n  \n  &lt;td&gt;\n    是\n  &lt;/td&gt;\n  \n  &lt;td&gt;\n    string\n  &lt;/td&gt;\n  \n  &lt;td&gt;\n    错误描述\n  &lt;/td&gt;\n&lt;/tr&gt;\n</code></pre>\n  </table>\n</div>\n<p>示例：</p>\n<pre><code>{\n    &quot;error&quot;:401,\n    &quot;message&quot;:&quot;token is not valid&quot;\n}\n</code></pre>\n<p>实测小站点一天只能推500条链接，超过了就会报错。不过目前来说是绝对够用了。</p>\n<h2 id=\"-2\">实现逻辑 <a class=\"header-anchor\" href=\"#-2\" aria-hidden=\"true\">&#128279;</a></h2>\n<p>关于这个工具，我能想到的比较合理的使用逻辑是这样的：</p>\n<ul>\n<li>建站已有一段时间，但是从来没用过百度主动推送，需要能够选择以往的链接并推送之</li>\n<li>旧的链接都已推送过，需要在有新页面发布时自动将其推送</li>\n</ul>\n<p>需要推送的页面包括但不限于：</p>\n<ul>\n<li>首页</li>\n<li>文章（Post）</li>\n<li>页面（Page）</li>\n<li>目录</li>\n<li>标签</li>\n</ul>\n<p>由于是第一版，目前这个工具的逻辑就是这样的：</p>\n<ol>\n<li>首先获取到Wordpress站点下所有的正常页面（已发布，无密码）</li>\n<li>让用户选择哪些页面需要被推送</li>\n<li>用户点击按钮，请求经由AJAX发回后台</li>\n<li>后台调用百度接口，实行推送</li>\n<li>返回并显示结果</li>\n</ol>\n<p>实际的效果就像这样（<del>点此参观</del> 2016-03-10更新：由于已更换为插件模式，原页面失效）：</p>\n<p><img src=\"https://raw.githubusercontent.com/wxsms/wxsms-img-holder/master/20160229092810.jpg\" alt=\"\"></p>\n<p>这个工具目前还很简陋。当然，如果你没有登录或者已登陆但没有管理员权限的话，点击Submit是会被拒绝的。</p>\n<h2 id=\"-3\">未来的目标 <a class=\"header-anchor\" href=\"#-3\" aria-hidden=\"true\">&#128279;</a></h2>\n<p>虽然是一个简单的东西，但我觉得它可以变得更好：</p>\n<ol>\n<li>用户应该可以填写自定义的链接</li>\n<li>它应该记住哪些链接已经被提交过了，这个状态应该显示在页面上，并且不再自动勾选</li>\n<li>自动触发推送的功能尚未实现，这个也是很重要的</li>\n<li>表格可以以一种更好的形式展现</li>\n<li>Log可以写得更友好一些</li>\n<li>做成插件</li>\n<li>……</li>\n</ol>\n<p>如无意外，这些都将在之后的版本更新。</p>\n<p>Github: <a href=\"https://github.com/edisond/baidu-submit-for-wordpress\">https://github.com/edisond/baidu-submit-for-wordpress</a></p>\n"}