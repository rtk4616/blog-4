<!DOCTYPE html><html class="nprogress-busy"><head><meta charset="utf-8"><meta name="google-site-verification" content="ekuL5J7xK1IdFtP13v3KxpuGKnYS1oCT9PvZdjYm8Eg"><meta name="viewport" content="user-scalable=no,width=device-width,initial-scale=1,maximum-scale=1"><link rel="shortcut icon" type="image/png" href="/static/favicon.png"><link rel="apple-touch-icon" sizes="200x200" href="/static/favicon-iphone.png"><title>wxsm's space - Better Documents</title><meta name="description" content="wxsms's personal blog."><meta name="keywords" content="Blog,JavaScript,HTML,CSS,Vue,Bootstrap"><link href="/static/css/app.c460d3b13d6d7ce0c63faa74a9023a8f.css" rel="stylesheet"><script type="text/javascript" src="/static/js/manifest.68263eefe155d055bfa0.js"></script><script type="text/javascript" src="/static/js/vendor.19a2875ac58b9bf76cc9.js"></script><script type="text/javascript" src="/static/js/app.6317672e36f60ab5ad32.js"></script><script async="" src="https://www.google-analytics.com/analytics.js" charset="utf8"></script><script async="" src="https://www.google-analytics.com/analytics.js" charset="utf8"></script><script type="text/javascript" charset="utf-8" async="" src="/static/js/0.24af7fe1e27d3b16bd28.js"></script><script type="text/javascript" charset="utf-8" async="" src="/static/js/4.f6eaab3002dc8add016f.js"></script><script type="text/javascript" charset="utf-8" async="" src="/static/js/0.24af7fe1e27d3b16bd28.js"></script><script type="text/javascript" charset="utf-8" async="" src="/static/js/1.3d038e42bb029d58fb1c.js"></script><script type="text/javascript" async="" id="embed-disqus" data-timestamp="1539144379951" src="//wxsm.disqus.com/embed.js"></script></head><body><section id="app"><section data-v-6a2c05ce="" style="display: none;"></section> <aside data-v-0044a876="" class=""><div data-v-0044a876="" class="brand"><h4 data-v-0044a876="" class="brand-link"><a data-v-0044a876="" href="/" class="router-link-active">wxsm's space</a></h4></div> <div data-v-0044a876="" class="search-container"><form data-v-e01410e2="" data-v-0044a876="" class="form-inline search-form-box"><div data-v-e01410e2="" class="form-group"><input data-v-e01410e2="" type="search" placeholder="Search..." required="required" minlength="2" class="form-control"></div></form></div> <div data-v-0044a876="" class="nav-container"><div data-v-0044a876="" class="nav-div"><ul data-v-0044a876="" role="tablist" class="nav nav-pills nav-stacked"><li data-v-0044a876="" role="presentation"><a data-v-0044a876="" href="/p" class="router-link-active btn btn-link" role="button">Archive</a></li><li data-v-0044a876="" role="presentation"><a data-v-0044a876="" href="/t" class="btn btn-link" role="button">Tags</a></li><li data-v-0044a876="" role="presentation"><a data-v-0044a876="" href="/g" class="btn btn-link" role="button">Guestbook</a></li><li data-v-0044a876="" role="presentation"><a data-v-0044a876="" href="/a" class="btn btn-link" role="button">About</a></li></ul></div> <div data-v-0044a876="" class="toc-div"><ul data-v-d065e12c="" data-v-0044a876="" class="toc-ul"><li data-v-d065e12c=""><a data-v-d065e12c="" href="#stage-1"><b data-v-d065e12c="">Stage-1 </b></a> <!----></li><li data-v-d065e12c=""><a data-v-d065e12c="" href="#stage-2"><b data-v-d065e12c="">Stage-2 </b></a> <!----></li><li data-v-d065e12c=""><a data-v-d065e12c="" href="#stage-3"><b data-v-d065e12c="">Stage-3 </b></a> <!----></li></ul></div></div></aside> <section data-v-79039cdb="" class="page"><div data-v-79039cdb="" class="page-body"><button data-v-01aba251="" data-v-79039cdb="" type="button" class="navbar-toggle collapsed"><span data-v-01aba251="" class="sr-only">Toggle navigation</span> <span data-v-01aba251="" class="icon-bar"></span> <span data-v-01aba251="" class="icon-bar"></span> <span data-v-01aba251="" class="icon-bar"></span></button> <div data-v-79039cdb="" class="container-fluid"><div data-v-79039cdb="" class="row"><div data-v-79039cdb="" class="col-xs-12"><section data-v-f233b600="" data-v-79039cdb=""><h1 data-v-f233b600="">Better Documents</h1> <section data-v-f233b600="" id="post-content"><section data-v-19e352bd="" data-v-f233b600=""><div data-v-19e352bd="" class="meta-block"><i data-v-19e352bd="" class="glyphicon glyphicon-calendar"></i> <span data-v-19e352bd="">October 27, 2017</span></div> <div data-v-19e352bd="" class="meta-block"><a data-v-3cd447cb="" data-v-19e352bd="" href="/t#Vue" class="label-tag"><span data-v-3cd447cb="" class="label label-success">Vue</span></a><a data-v-3cd447cb="" data-v-19e352bd="" href="/t#Github" class="label-tag"><span data-v-3cd447cb="" class="label label-warning">Github</span></a><a data-v-3cd447cb="" data-v-19e352bd="" href="/t#Webpack" class="label-tag"><span data-v-3cd447cb="" class="label label-primary">Webpack</span></a><a data-v-3cd447cb="" data-v-19e352bd="" href="/t#Markdown" class="label-tag"><span data-v-3cd447cb="" class="label label-default">Markdown</span></a><a data-v-3cd447cb="" data-v-19e352bd="" href="/t#User-Experience" class="label-tag"><span data-v-3cd447cb="" class="label label-primary">User-Experience</span></a></div></section> <div data-v-f233b600=""><p>这篇文章记录了我是如何一步步地把 <a href="https://github.com/wxsms/uiv">https://github.com/wxsms/uiv</a> 这个项目的用户文档变得更优雅的。实际上，如何以一种<strong>高效又优雅</strong>的方式编写<strong>实例文档</strong>一直是我的一个疑惑，比如主要的问题体现在：</p>
<ul>
<li>如何使文档更易读？</li>
<li>如何使文档更易于维护？</li>
<li>如何减少编写文档的工作量？</li>
<li>实例代码无可避免地需要手工维护吗？</li>
</ul>
<p>最后一点是让我最头疼的地方。举个例子，我想要给用户展示一个组件的使用方式，以下代码可以在页面上创建一个 Alert：</p>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">alert</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"success"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>Well done!<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span> You successfully read this important alert message.<span class="hljs-tag">&lt;/<span class="hljs-name">alert</span>&gt;</span>
</code></pre>
<p>那么，我总要给用户一个相对应的<strong>实例</strong>吧。我要在我的文档上面就创建一个这样的 Alert，同时告诉用户说你可以这么用。这是一个很普遍的展示方式，那么问题就在这里了，我是否要将<strong>同样的代码写两次</strong>呢？</p>
<p>一开始我确实就是这么做的，虽然我知道这不科学，不高效，更不优雅。但我实在是想不到更好的办法了。</p>
<p>但是，现在，我已经（几乎）把以上的问题都解决了。</p>
<!--more-->
<h2 id="stage-1">Stage-1 <a class="header-anchor" href="#stage-1" aria-hidden="true">🔗</a></h2>
<p>写文档这件事，实际上跟写文章差不多，写作体验很重要。</p>
<p>在最开始的时候，项目文档是直接用 Vue 文件编写的，没有经过任何处理，没有经验的我甚至还作死地加入了 i18n，可以说是非常有趣了。以至于到最近，在没有发生这次重构之前，我根本不想动它们。</p>
<p>可以想象，我给关键字句加个粗要手写 <code>&lt;b&gt;...&lt;/b&gt;</code>，标记一点代码要用 <code>&lt;code&gt;...&lt;/code&gt;</code>，每写一段话都要注意标签标签标签，文档里充斥这些东西，烦不胜烦。</p>
<p>这阶段的文档，存在的问题主要有：</p>
<ul>
<li>难以编写</li>
<li>无法在网站以外的地方阅读（因为是 Vue 源码）</li>
<li>给项目增加了许多额外代码</li>
<li>手工维护的实例代码</li>
</ul>
<h2 id="stage-2">Stage-2 <a class="header-anchor" href="#stage-2" aria-hidden="true">🔗</a></h2>
<p>以上提到的写作体验令人作呕，经过了漫长的时间后，在这一阶段得到了解决。某次机缘巧合，我发现了这样一个工具，它可以通过 webpack 将 Markdown 格式的文本直接转换成为 Vue 组件：<a href="https://github.com/QingWei-Li/vue-markdown-loader">vue-markdown-loader</a></p>
<p>比如：</p>
<pre><code class="language-javascript"><span class="hljs-built_in">module</span>.exports = {
  <span class="hljs-attr">module</span>: {
    <span class="hljs-attr">rules</span>: [
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.md$/</span>,
        <span class="hljs-attr">loader</span>: <span class="hljs-string">'vue-markdown-loader'</span>
      }
    ]
  }
};
</code></pre>
<p>这样一来，就可以通过 <code>import [*].md</code> 的方式，得到一个内含 Markdown 内容（已转 HTML）的 Vue 组件。可以直接在页面上用了！</p>
<p>如果不考虑<strong>实例</strong>部分的话，这就已经完美了。准确地说，如果一开始就不需要实例这种东西，那么我肯定会直接用 Gitbook 了。也不需要这个 markdown to vue 来做什么。</p>
<hr>
<p>经过了长时间的折磨的我身心疲惫，最终还是决定尝试一下。</p>
<p>然而，就在这个尝试的过程中惊喜地发现：<strong>它居然还可以执行 Markdown 中的 Code block 中的代码！</strong></p>
<p>这是什么鬼。一开始发现这个的时候我还是很惊讶的。仿佛打开了新世界的大门。</p>
<p><strong>在后来的不断尝试 - 失败 - 尝试的过程中，我发现了它更多的 Feature：</strong></p>
<ul>
<li>可以执行 Code blocks 中的代码（<code>&lt;script&gt;</code>）</li>
<li>可以执行 Code blocks 中的样式（<code>&lt;style&gt;</code>）</li>
<li>可以通过插件给文档 header 加锚点</li>
</ul>
<p><strong>但是，也发现了以下问题：</strong></p>
<ul>
<li>多个 Code blocks 中的 <code>&lt;style&gt;</code> 可以合并，但 <code>&lt;script&gt;</code> 不行，<strong>它始终只会执行所找到的第一段 <code>&lt;script&gt;</code></strong></li>
</ul>
<p>通过查阅 <code>vue-loader</code> 的文档发现，这是 <code>.vue</code> 文件本身的限制：支持多个 <code>&lt;template&gt;</code>，多个 <code>&lt;style&gt;</code>，<strong>一个 <code>&lt;script&gt;</code></strong></p>
<p>也就是说，如果页面上有多个实例需要展示的话，给给。</p>
<p>如果这个问题能够解决的话，再结合我本身的需求，以下内容也需要实现：</p>
<ul>
<li>将实例代码中的 <code>&lt;template&gt;</code> 模板插入到其代码块之前，让其成为 Markdown 文件的一部分，然后 Vue 就会自动将它们统统实例化</li>
</ul>
<hr>
<p><strong>其实到了这里，也就是这两个问题需要解决了。</strong></p>
<p>首先是<strong>模板插入</strong>的问题。这个其实不难，在 Markdown 完成渲染前，通过一些手段找到这些需要渲染的模板，然后手动插入。幸而 loader 提供了 <code>preprocess</code> 钩子，让我能直接完成这件事情。</p>
<p>然后，关于 <code>&lt;script&gt;</code> 这块，我尝试了好久好久，实在是没办法。但是又真的舍不得因为这仅仅一个问题丢弃以上的那么多的好处。于是就想到了一个折中的办法：禁用 loader 的自动执行代码功能，并手动组装代码块。然而一个悲催的问题又出现了：禁用自动代码执行后，<code>&lt;style&gt;</code> 也无法自动执行了。</p>
<p>解决方案：我需要在 <code>preprocess</code> 中将 Code blocks 里面的 <code>&lt;style&gt;</code> 块全部切出来，贴到 code blocks 的外面（比如文件结尾处）去。一开始我还尝试了将它们的内容合并成为一个 <code>&lt;style&gt;</code>，后来发现其实不需要，因为 <code>vue-loader</code> 本身就支持一个文件多个 <code>&lt;style&gt;</code> 节点。</p>
<p>最后的最后，轮到了 <code>&lt;script&gt;</code> 的组装。我尝试了很久的自动合并，比如将它们的 export 内容转为 object 再 merge 啦，function 转为 object 再 merge 啦，toString 再 merge 啦，等等等等，然而各种方式都以失败告终。结论是：我无法将数个字符串代码块直接合并，也无法转为 object 再合并再转回字符串。实在的实在是没办法了，hard code 吧。</p>
<hr>
<p>至此，一个新的解决方案就出现了。简单来说，编写一片文档，我需要做以下的事情：</p>
<ul>
<li>用 Markdown 写文档以及实例代码</li>
<li>实例代码块中加入约定的标志</li>
<li>注意同一个 Markdown 中的实例代码块的 <code>&lt;script&gt;</code> 不能相互冲突</li>
<li>做完所有事情以后，用我自己用智商和爱将所有的实例代码合并成一份</li>
</ul>
<p>大功告成。</p>
<p>虽然依然有些麻烦，但相比与 Stage-1，我至少解决了以下的大事：</p>
<ul>
<li>文档编写体验大幅度提升！</li>
<li>文档可以在网站以外的地方被阅读（如 Github）</li>
<li>实例的 <code>&lt;template&gt;</code> 与 <code>&lt;style&gt;</code> 代码无需再有特殊照顾</li>
<li>维护工作量大大减少</li>
</ul>
<p>依然存在的问题是：</p>
<ul>
<li>实例的 <code>&lt;script&gt;</code> 代码需要维护两份，而且不能彼此冲突</li>
</ul>
<h2 id="stage-3">Stage-3 <a class="header-anchor" href="#stage-3" aria-hidden="true">🔗</a></h2>
<p>虽然解决了 80% 的问题，但 Stage-2 依然不完美。我始终想要解决最后一个问题：<strong>无需特殊照顾的实例 <code>&lt;script&gt;</code></strong></p>
<p>想要达到这个目标，有一个完美的办法就是：<strong>将实例也作为子组件来插入到 Markdown 父组件中去</strong>。这样一来，同一页面的实例代码无法冲突的问题也就一并解决了。</p>
<p>显然，通过目前的 loader 无法达到我想要的效果，它只能够简单地将代码插入 Markdown，并不能构建子组件。因此，要解决这个问题，<strong>我需要自己造轮子</strong>。</p>
<p>......</p>
<hr>
<p>于是就有了：</p>
<p><a href="https://github.com/wxsms/vue-md-loader">https://github.com/wxsms/vue-md-loader</a></p>
<p>关于这个轮子，它是原有 markdown-loader 的一个替代品，<strong>并且能够解决以上提出的所有问题</strong>。</p>
<p>除了完善的原有 Markdown 转换功能以外，它还可以将 Markdown 中的实例代码，比如：</p>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"cls"</span>&gt;</span>{{msg}}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    data () {
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">msg</span>: <span class="hljs-string">'Hello world!'</span>
      }
    }
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
  <span class="hljs-selector-class">.cls</span> {
    <span class="hljs-attribute">color</span>: red;
    <span class="hljs-attribute">background</span>: green;
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-comment">&lt;!-- some-live-demo.vue --&gt;</span>
</code></pre>
<p>变成类似这样的结构：</p>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">some-live-demo</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">pre</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">pre</span>&gt;</span>
</code></pre>
<blockquote>
<p>A <strong>Vue component</strong> with all it's <code>&lt;template&gt;</code>, <code>&lt;script&gt;</code> and <code>&lt;style&gt;</code> settled will be <strong>inserted before it's source code block</strong>.</p>
</blockquote>
<p>毫无疑问，它<strong>支持同一文件中的多个代码块</strong>。</p>
<p>关于这个插件，其实就是一个典型的、简单的 webpack loader，将一个 markdown 文件转换成了可以被 <code>vue-loader</code> 识别并加载的 vue 文件。</p>
<p>它的实现思路主要有：</p>
<ul>
<li>将实例代码块中的 <code>&lt;style&gt;</code> 直接截取，并放到 Markdown 组件下</li>
<li>将实例代码块中的 <code>&lt;script&gt;</code> 中 <code>export default</code> 的内容截取，并作为各自的 Component options</li>
<li>加上相应代码块中的 <code>&lt;template&gt;</code> 中的内容，稍微组装一下，它就成为了一个 Vue component</li>
<li>在 Markdown 组件中局部注册该 component，并将它插入到代码块的前面去</li>
<li>对于 <code>export default</code> 外部的内容，把它们抽取出来，集中放到 Markdown 组件下</li>
</ul>
<p>以上这些操作，全部通过字符串与正则操作就足以完成了。</p>
<p>然而可以发现，这里面仍有一些有待解决的问题：</p>
<ul>
<li><code>&lt;style&gt;</code> 有可能冲突</li>
<li><code>export default</code> 之外的内容有可能冲突</li>
</ul>
<p>这两个问题目前也还没有想到有效的解决办法。但是，就目前来说，满足我的需求已经完全足够了。遗留问题通过后续的开发来逐步解决吧。</p>
<hr>
<p>至此，优雅地编写项目文档的全部要素就齐备了：</p>
<ul>
<li>纯文档编写体验（Markdown）</li>
<li>文档可以在网站以外的地方被阅读（如 Github）</li>
<li>实例代码均无需特殊照顾，所有过程自动完成</li>
<li>没有维护压力</li>
</ul>
<p><strong>Enjoy!</strong></p>
</div> <hr data-v-f233b600=""> <nav data-v-7144c3e4="" data-v-f233b600=""><ul data-v-7144c3e4="" class="pager"><li data-v-7144c3e4="" class="previous"><a data-v-7144c3e4="" href="/p/difference-between-npm-dependencies-types" class=""><i data-v-7144c3e4="" class="glyphicon glyphicon-chevron-left"></i> Difference Between NPM Dependencies Types
      </a></li> <li data-v-7144c3e4="" class="next"><a data-v-7144c3e4="" href="/p/limit-prerender-plugin-workers-by-webpack" class="">
        Limit Prerender Plugin Workers By Webpack <i data-v-7144c3e4="" class="glyphicon glyphicon-chevron-right"></i></a></li></ul></nav> <hr data-v-f233b600=""> <div data-v-1a6fe007="" data-v-f233b600="" id="disqus_thread"><i data-v-1a6fe007="" class="glyphicon glyphicon-refresh icon-spin"></i> <span data-v-1a6fe007="">Loading Disqus......</span></div></section></section></div></div></div></div> <section data-v-f9dc3034="" data-v-79039cdb="" class="page-footer"><div data-v-f9dc3034="" class="container-fluid"><div data-v-f9dc3034="" class="row"><div data-v-f9dc3034="" class="col-xs-12"><p data-v-f9dc3034=""><span data-v-f9dc3034="">Links:</span> <!----> <a data-v-f9dc3034="" href="https://blog.aquariuslt.com/" target="_blank">Aquariuslt</a><span data-v-f9dc3034="">&nbsp;/</span> <a data-v-f9dc3034="" href="https://lz5z.com" target="_blank">Leo's Blog</a></p></div></div> <div data-v-f9dc3034="" class="row"><div data-v-f9dc3034="" class="col-xs-12"><a data-v-f9dc3034="" href="https://wxsm.space">© 2018 WXSM</a> <span data-v-f9dc3034="">/</span> <a data-v-f9dc3034="" href="/feed.xml" rel="nofollow" target="_blank">FEED</a> <span data-v-f9dc3034="">/</span> <a data-v-f9dc3034="" title="LICENSE" href="https://creativecommons.org/licenses/by/4.0/" rel="nofollow">CC BY 4.0</a></div></div></div></section></section></section>
<div id="nprogress" style="transition: none; -webkit-transition: none; opacity: 1;"><div class="bar" role="bar" style="transition: all 200ms ease; -webkit-transition: all 200ms ease; -webkit-transform: translate3d(0%, 0px, 0px);"><div class="peg"></div></div></div></body></html>
